# Сервис мониторинга сайта

Сервис для мониторинга работоспособности веб-сайта с автоматическим обновлением записей при обнаружении проблем.

## Описание

Этот сервис выполняет следующие функции:
- Периодически проверяет доступность указанного веб-сайта
- Проверяет корректность JSON-ответов
- Отслеживает количество последовательных ошибок
- Автоматически обновляет записи при достижении определенного порога ошибок
- Ведет подробное логирование всех операций

## Требования

- Python 3.7+
- Poetry (опционально)

## Установка

1. Клонируйте репозиторий и перейдите в директорию проекта:
```bash
git clone git@github.com:sonechkak/dns_switcher_project.git
cd dns_switcher_project
```

2. Установите зависимости с помощью Poetry:
```bash
poetry install
```

3. Создайте файл .env в корневой директории проекта и добавьте следующие настройки:
```env
SITE_MAP=your_site.com:dev.site.com,your_site.com:127.0.0.1,196.168.0.1;your_site1.com:dev.site1.com:127.0.0.1,196.168.0.1
CHECK_INTERVAL_SECONDS=5
```

## Запуск

Для запуска сервиса выполните команду:
```bash
python src/monitor.py
```

## Настройка

Сервис настраивается через переменные окружения:
- `DATA_MAP`: Карта сайтов и их зеркал в формате `site:mirror1,mirror2,mirror3;site1:mirror1,mirror2` (по умолчанию: отсутствует)
- `CHECK_INTERVAL_SECONDS`: Интервал между проверками в секундах (по умолчанию: 5)
- `CLOUDFLARE_API_TOKEN`: Токен API Cloudflare (по умолчанию: отсутствует)
- `CLOUDFLARE_EMAIL`: ID зоны Cloudflare (по умолчанию: отсутствует)

## Логирование

Сервис ведет подробное логирование всех операций. В логах содержится:
- Метка времени каждого события
- Уровень важности сообщения
- Результаты проверок сайта
- Информация об ошибках и предупреждениях

## Обработка ошибок

- Сервис подсчитывает количество последовательных ошибок
- После двух последовательных ошибок происходит автоматическое обновление записи
- Счетчик ошибок сбрасывается после успешной проверки или обновления записи

## Зависимости

- requests: Библиотека для HTTP-запросов
- python-dotenv: Работа с переменными окружения
- logging: Система логирования
- asyncio: Асинхронное выполнение операций

## Для разработчиков

При внесении изменений в код убедитесь, что:
1. Все значимые действия фиксируются в логах
2. Правильно обрабатываются исключения

## Лицензия
см. файл LICENSE.txt
